<app-header-poly></app-header-poly>
<div class="container-fluid "  style="margin-top: 8rem">
  <div class="col mb-3 mb-lg-5" *ngFor="let msg of messages; let i = index">

    <!-- Card -->
    <div class="card card-body">
      <div class="d-flex">

        <!-- Avatar -->
        <div class="flex-shrink-0 me-3 me-lg-4">
          <img class="avatar" src="chatIcons/poly.png" alt="Image Description">
        </div>

        <div class="flex-grow-1 ms-3">
          <div class="row align-items-sm-center">
            <div class="col">
              <h3 class="mb-1">{{ msg.name || 'Unknown' }}</h3>
            </div>

            <div class="col-md-3 d-none d-md-flex justify-content-md-end ms-n3">
              <!-- Avatar Group -->
              </div>
          </div>

          <!-- Stats -->
          <ul class="list-inline">
            <li class="list-inline-item px-3">
              <span class="fs-5">Email:</span>
              <span class="fw-semibold text-dark">{{ msg.email }}</span>
            </li>

            <li class="list-inline-item">
              <span class="fs-5">Registration No.</span>
              <span class="fw-semibold text-dark">{{ msg.registrationNumber }}</span>
            </li>
          </ul>

          <div class="" style="border: 0;">
            <div class="card-body px-1 px-md-3">
              <h4><u>Message</u></h4>

              {{ msg.message }}

              <div class="d-flex justify-content-between align-items-center mt-2">
                <a class="link" (click)="openReply(msg)">Reply</a>

                <button
                  class="btn btn-sm btn-outline-danger"
                  (click)="deleteMessage(i)"
                >
                  Delete
                </button>
              </div>
            </div>
          </div>

          <!-- âŒ Removed this line because it causes page reload:
               <a class="stretched-link" href="#"></a>
          -->

        </div>
      </div>
    </div>
    <!-- End Card -->

  </div>

  <div class="px-1" style="overflow-x: hidden"></div>
</div>


@if (openModal) {
  <div class="modal-overlay">
    <app-modal  (closeModal)="closeModal()">
      <div class="shadow-none">
        <div class="modal-content p-4">

          <!-- Header -->
          <div class="text-center mb-4">

            <h2>Reply to {{ selectedMessage?.name }}</h2>
          </div>

          <!-- Message Details -->
          <div class="mb-3">
            <p><strong>Email:</strong> {{ selectedMessage?.email }}</p>
            <p><strong>Registration Number:</strong> {{ selectedMessage?.registrationNumber }}</p>
            <p><strong>Original Message:</strong> {{ selectedMessage?.message }}</p>
          </div>

          <!-- Reply Textarea -->
          <div class="mb-4">
            <label class="fw-bold">Your Reply</label>
            <textarea
              class="form-control"
              rows="5"
              [(ngModel)]="replyText"
              placeholder="Type your reply..."></textarea>
          </div>

          <!-- Footer Buttons -->
          <div class="d-flex justify-content-end gap-3">
            <button class="btn btn-secondary" (click)="closeModal()">Cancel</button>
            <button class="btn btn-primary" (click)="sendReply()">Send</button>
          </div>

        </div>
      </div>
    </app-modal>
  </div>
}
