<app-header-poly></app-header-poly>

<div class="card content-space-1" style="margin: 0; text-align: left;">
  <!-- Header -->
  <div class="card-header">
    <div class="row justify-content-between align-items-center flex-grow-1">
      <div class="col-md">
        <h4 class="card-header-title">Students</h4>
      </div>

      <!-- Search -->
      <div class="col-md-4">
        <form>
          <div class="input-group input-group-merge input-group-flush">
            <div class="input-group-prepend input-group-text">
              <i class="bi-search"></i>
            </div>
            <input
              type="search"
              class="form-control"
              placeholder="Search students"
              [(ngModel)]="searchTerm"
              name="searchTerm"
              (input)="filterStudents()"
              aria-label="Search students"
            />
          </div>
        </form>
      </div>
    </div>
  </div>
  <!-- End Header -->

  <!-- Table -->
  <div class="table-responsive datatable-custom" style="text-align: left;">
    <table class="table table-borderless table-thead-bordered table-nowrap card-table w-100" style="margin: 0;">
      <thead class="thead-light">
      <tr>
        <th>#</th>
        <th>Full Name</th>
        <th>Email</th>
        <th>Phone</th>
        <th>Reg. No</th>
        <th>Department</th>
        <th>Course</th>
        <th>Level</th>
        <th>School</th>
        <th>Gender</th>
        <th>Created On</th>
        <th>Action</th>
      </tr>
      </thead>
      <tbody>
      <tr *ngFor="let student of paginatedStudents(); let i = index">
        <td>{{ (currentPage() - 1) * itemsPerPage + i + 1 }}</td>
        <td>{{ student.name }}</td>
        <td>{{ student.email }}</td>
        <td>{{ student.phone }}</td>
        <td>{{ student.registrationNumber }}</td>
        <td>{{ student.department }}</td>
        <td>{{ student.course }}</td>
        <td>{{ student.level }}</td>
        <td>{{ student.school }}</td>
        <td>{{ student.gender }}</td>
        <td>{{ student.createdOn | date: 'medium' }}</td>
        <td>
          <button class="btn btn-primary" (click)="openPost(student)">Message</button>
        </td>

      </tr>

      <tr *ngIf="filteredStudents().length === 0">
        <td colspan="12" class="text-center text-muted">No students found.</td>
      </tr>
      </tbody>
    </table>
  </div>
  <!-- End Table -->

  <!-- Footer (Pagination) -->
  <div class="card-footer">
    <div class="row justify-content-center justify-content-sm-between align-items-sm-center">
      <div class="col-sm mb-sm-0">
        <span class="me-2">Showing:</span>
        <span>{{ paginatedStudents().length }}</span>
        <span class="text-secondary mx-2">of</span>
        <span>{{ filteredStudents().length }}</span>
      </div>

      <div class="col-sm-auto">
        <ul class="pagination datatable-custom-pagination">
          <li class="page-item" [class.disabled]="currentPage() === 1">
            <a class="page-link" href="javascript:;" (click)="prevPage()">Prev</a>
          </li>
          <li *ngFor="let page of totalPages"
              class="page-item"
              [class.active]="currentPage() === page">
            <a class="page-link" href="javascript:;" (click)="goToPage(page)">{{ page }}</a>
          </li>
          <li class="page-item" [class.disabled]="currentPage() === totalPages.length">
            <a class="page-link" href="javascript:;" (click)="nextPage()">Next</a>
          </li>
        </ul>
      </div>
    </div>
  </div>
  <!-- End Footer -->
</div>
<div class="modal-overlay" *ngIf="post()">
  <app-modal [width]="'600px'" [height]="'500px'" (closeModal)="closePost()">
    <div class="shadow-none">
      <div class="modal-content">
        <div class="mb-7">
          <div class="card h-100 shadow-none border-0">
            <!-- Header -->
            <div class="card-header">
              <h4>Student Info</h4>
            </div>
            <!-- Body -->
            <div class="card-body pb-0" style="height: 250px; overflow-y: auto;">
              <ng-container *ngIf="selectedStudent() as student">
                <p><strong>Name:</strong> {{ student.name }}</p>
                <p><strong>Registration Number:</strong> {{ student.registrationNumber }}</p>
                <p><strong>Email:</strong> {{ student.email }}</p>

                <!-- Textarea for message -->
                <div class="mt-3">
                  <label for="messageText" class="form-label"><strong>Message</strong></label>
                  <textarea
                    id="messageText"
                    class="form-control"
                    [(ngModel)]="messageText"
                    rows="3"
                    placeholder="Type your message here..."
                    [disabled]="isSubmitting()"
                  ></textarea>
                </div>
              </ng-container>
            </div>
            <!-- Footer -->
            <div class="card-footer d-flex justify-content-between">
              <button class="btn btn-secondary" (click)="closePost()" [disabled]="isSubmitting()">Close</button>
              <button class="btn btn-primary" (click)="sendMessage()" [disabled]="isSubmitting()">
                <span *ngIf="isSubmitting()">Sending...</span>
                <span *ngIf="!isSubmitting()">Send</span>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </app-modal>
</div>

