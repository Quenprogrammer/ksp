
<app-header-poly></app-header-poly>
<div class="container-fluid content-space-3">

  <div class="row g-1">
    <div class="col-lg-6 order-2 order-sm-1">
      <!-- Card -->

      <app-comment></app-comment>

    </div>

    <div class="col-lg-6 order-1 order-sm-2">
      <div class="d-grid gap-3 gap-lg-0">
        <!-- Card -->
        <div class="card mb-0">
          <!-- Header -->
          <div class="card-header card-header-content-between">
            <h5 class="card-header-title mb-0">User Ratings Overview</h5>
            <button
              class="btn btn-sm btn-outline-primary"
              (click)="deviceModal.set(true)"
              [disabled]="hasVoted()">
              {{ hasVoted() ? 'You already voted' : 'Rate Us' }}
            </button>

          </div>
          <!-- End Header -->

          <!-- Body -->
          <div class="card-body card-body-height" style="height: 30rem;">
            <div class="text-center">
              <!-- Chart -->
              <div [style.width.px]="chartWidth" style="margin:auto;">
                <canvas id="doughnutHalfChart"></canvas>
              </div>

              <!-- Stats -->
              <div class="row col-divider mt-4">
                <div class="col text-end">
              <span class="d-block h4 mb-0 text-success">
                üëç {{ satisfactory() }}
              </span>
                  <span class="d-block text-muted">Satisfactory</span>
                </div>

                <div class="col text-start">
              <span class="d-block h4 mb-0 text-danger">
                üëé {{ needsImprovement() }}
              </span>
                  <span class="d-block text-muted">Needs Improvement</span>
                </div>
              </div>

              <!-- Percentages -->
              <div class="mt-3">
                <ng-container *ngIf="(satisfactory() + needsImprovement()) > 0; else noRatings">
                  <p class="mb-0 fw-bold">
                    Satisfactory:
                    {{
                      (satisfactory() / (satisfactory() + needsImprovement()) * 100)
                        | number : '1.0-0'
                    }}%
                    |
                    Needs Improvement:
                    {{
                      (needsImprovement() / (satisfactory() + needsImprovement()) * 100)
                        | number : '1.0-0'
                    }}%
                  </p>
                </ng-container>
                <ng-template #noRatings>
                  <p class="text-muted mb-0">No ratings yet</p>
                </ng-template>
              </div>
            </div>
          </div>
          <!-- End Body -->
        </div>
        <!-- End Card -->
      </div>

      <!-- Sticky Block End Point -->
      <div id="stickyBlockEndPoint"></div>
    </div>

  </div>

</div>
<div class="modal-overlay" *ngIf="deviceModal()">
  <app-modal [width]="'450px'" [height]="'500px'" (closeModal)="closeModal()">
    <div class="d-flex justify-content-center align-items-center" style="height: 400px;">
      <div class="modal-content text-center p-4 position-relative"
           style="max-width: 420px; width: 100%; margin: auto; border-radius: 20px; height: 400px; display: flex; flex-direction: column; justify-content: center; align-items: center;">

        <!-- Close button -->

        <!-- Icon -->
        <div class="mb-3">
          <img src="chatIcons/poly/tansparent.png" alt="Experience Icon" style="width: 140px;" />
        </div>

        <!-- Title -->
        <h3 class="card-title mb-2">Rate Your Experience</h3>
        <p class="card-text text-muted mb-4" style="max-width: 300px;">
          Please let us know if your experience was satisfactory.
        </p>

        <!-- Rating Buttons -->
        <div class="d-flex justify-content-center gap-3 mb-3">
          <button
            type="button"
            class="btn btn-outline-success px-4 py-2"
            [class.active]="selectedRating === 'Good'"
            (click)="setRating('Good')">
            Satisfactory
          </button>

          <button
            type="button"
            class="btn btn-outline-danger px-4 py-2"
            [class.active]="selectedRating === 'Bad'"
            (click)="setRating('Bad')">
            Needs Improvement
          </button>
        </div>

        <!-- Saving Spinner -->
        <div *ngIf="isSaving()" class="text-center mt-2">
          <span class="spinner-border spinner-border-sm text-primary"></span>
          <small class="ms-2">Saving...</small>
        </div>
      </div>
    </div>
  </app-modal>
</div>

