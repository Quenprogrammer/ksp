<app-header-poly></app-header-poly>
<div class="container " style="margin-top: 100px">
  <h2>All Messages</h2>
  <div class="table-responsive">
    <table class="table table-bordered table-hover">
      <thead class="thead-light">
      <tr>
        <th scope="col">Content</th>
        <th scope="col">Sender</th>
        <th scope="col">Status</th>
        <th scope="col">Actions</th>
      </tr>
      </thead>
      <tbody>
      <tr *ngFor="let message of messages$ | async">
        <td (click)="viewMessage(message)" style="cursor:pointer">{{ message.content }}</td>
        <td>{{ message.sender }}</td>
        <td>{{ message.status }}</td>
        <td>
          <button class="btn btn-danger btn-sm" (click)="deleteMessage(message.id!)">Delete</button>
        </td>
      </tr>
      </tbody>
    </table>
  </div>
</div>

<!-- Modal -->
<div class="modal fade show" tabindex="-1" [ngClass]="{'d-block': showModal}" *ngIf="selectedMessage">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Message Details</h5>
        <button type="button" class="btn-close" (click)="closeModal()"></button>
      </div>
      <div class="modal-body">
        <p><strong>Content:</strong> {{ selectedMessage?.content }}</p>
        <p><strong>Sender:</strong> {{ selectedMessage?.sender }}</p>
        <p><strong>Status:</strong> {{ selectedMessage?.status }}</p>
        <p><strong>Created At:</strong> {{ selectedMessage?.createdAt?.toDate() | date:'medium' }}</p>

        <h6>Device Info</h6>
        <ul class="list-group list-group-flush">
          <li class="list-group-item"><strong>Browser:</strong> {{ selectedMessage?.device?.browser }}</li>
          <li class="list-group-item"><strong>Device Type:</strong> {{ selectedMessage?.device?.deviceType }}</li>
          <li class="list-group-item"><strong>Language:</strong> {{ selectedMessage?.device?.language }}</li>
          <li class="list-group-item"><strong>Online:</strong> {{ selectedMessage?.device?.online }}</li>
          <li class="list-group-item"><strong>OS:</strong> {{ selectedMessage?.device?.os }}</li>
          <li class="list-group-item"><strong>Platform:</strong> {{ selectedMessage?.device?.platform }}</li>
          <li class="list-group-item"><strong>Screen Resolution:</strong> {{ selectedMessage?.device?.screenResolution }}</li>
          <li class="list-group-item"><strong>User Agent:</strong> {{ selectedMessage?.device?.userAgent }}</li>
          <li class="list-group-item"><strong>Vendor:</strong> {{ selectedMessage?.device?.vendor }}</li>
          <li class="list-group-item"><strong>Recipient IDs:</strong> {{ selectedMessage?.recipientIds?.join(', ') }}</li>
        </ul>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="closeModal()">Close</button>
      </div>
    </div>
  </div>
</div>
