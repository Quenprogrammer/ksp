<div class="custom-modal-overlay" *ngIf="showModal" (click)="onClose()">
  <div class="custom-modal" (click)="$event.stopPropagation()">

    <!-- Modal Header -->
    <div class="modal-header">
      <h2 class="modal-title">Share Your Experience</h2>
      <button type="button" class="close-btn" (click)="onClose()" aria-label="Close">
        <i class="bi bi-x-lg"></i>
      </button>
    </div>

    <!-- Modal Body -->
    <div class="modal-body">
      <form #testimonialForm="ngForm">

        <!-- Avatar Preview -->
        <div class="avatar-preview-container text-center mb-4">
          <div class="avatar-preview mx-auto mb-2"
               [style.backgroundColor]="getAvatarColor()">
            {{ getAvatarPreview() }}
          </div>
          <small class="text-muted">Avatar preview (based on your name)</small>
        </div>

        <!-- Name -->
        <div class="form-group mb-3">
          <label for="name" class="form-label">
            Your Name *
            <span class="text-danger">*</span>
          </label>
          <input type="text"
                 class="form-control"
                 id="name"
                 [(ngModel)]="testimonial.name"
                 name="name"
                 required
                 placeholder="Enter your name">
        </div>

        <!-- Email (optional) -->
        <div class="form-group mb-3">
          <label for="email" class="form-label">Your Email</label>
          <input type="email"
                 class="form-control"
                 id="email"
                 [(ngModel)]="testimonial.email"
                 name="email"
                 placeholder="Enter your email (optional)">
        </div>

        <!-- Product -->
        <div class="form-group mb-3">
          <label for="product" class="form-label">
            Product Name *
            <span class="text-danger">*</span>
          </label>
          <select class="form-control"
                  id="product"
                  [(ngModel)]="testimonial.product"
                  name="product"
                  required>
            <option value="" disabled selected>Select a product</option>
            <option *ngFor="let product of products" [value]="product">{{ product }}</option>
          </select>
        </div>

        <!-- Rating -->
        <div class="form-group mb-4">
          <label class="form-label">
            Rating *
            <span class="text-danger">*</span>
          </label>
          <div class="rating-container">
            <div class="rating-stars">
              <button type="button"
                      *ngFor="let star of [1,2,3,4,5]; let i = index"
                      class="star-btn"
                      (click)="setRating(i + 1)"
                      [class.active]="i < testimonial.rating">
                <i class="bi"
                   [class.bi-star-fill]="i < testimonial.rating"
                   [class.bi-star]="i >= testimonial.rating"></i>
              </button>
            </div>
            <div class="rating-text" *ngIf="testimonial.rating > 0">
              Selected: {{ testimonial.rating }} star{{ testimonial.rating > 1 ? 's' : '' }}
            </div>
          </div>
        </div>

        <!-- Title -->
        <div class="form-group mb-3">
          <label for="title" class="form-label">
            Testimonial Title *
            <span class="text-danger">*</span>
          </label>
          <input type="text"
                 class="form-control"
                 id="title"
                 [(ngModel)]="testimonial.title"
                 name="title"
                 required
                 placeholder="e.g., Perfect for daily use!">
        </div>

        <!-- Testimonial Text -->
        <div class="form-group mb-3">
          <label for="text" class="form-label">
            Your Testimonial *
            <span class="text-danger">*</span>
          </label>
          <textarea class="form-control"
                    id="text"
                    rows="4"
                    [(ngModel)]="testimonial.text"
                    name="text"
                    required
                    placeholder="Share your experience with our product..."></textarea>
          <small class="text-muted">Tell us what you love about our product!</small>
        </div>

        <!-- Image URL -->
        <div class="form-group mb-4">
          <label for="imageUrl" class="form-label">Profile Image URL (Optional)</label>
          <input type="url"
                 class="form-control"
                 id="imageUrl"
                 [(ngModel)]="testimonial.imageUrl"
                 name="imageUrl"
                 placeholder="https://example.com/your-photo.jpg">
          <small class="text-muted">Leave empty to use your initial as avatar</small>
        </div>

      </form>
    </div>

    <!-- Modal Footer -->
    <div class="modal-footer">
      <button type="button"
              class="btn btn-secondary"
              (click)="onClose()">
        Cancel
      </button>
      <button type="button"
              class="btn btn-primary"
              (click)="onSubmit()"
              [disabled]="!testimonial.name || !testimonial.product ||
                         !testimonial.rating || !testimonial.title ||
                         !testimonial.text">
        <i class="bi bi-send me-2"></i>
        Submit Testimonial
      </button>
    </div>

  </div>
</div>
